(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{528:function(s,a,t){s.exports=t.p+"assets/img/image-20200624164149872.ad67e41f.png"},529:function(s,a,t){s.exports=t.p+"assets/img/image-20200626113738729.8e725e7c.png"},530:function(s,a,t){s.exports=t.p+"assets/img/image-20200626115037722.859ff36f.png"},632:function(s,a,t){"use strict";t.r(a);var n=t(21),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"架构说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#架构说明"}},[s._v("#")]),s._v(" 架构说明")]),s._v(" "),n("h2",{attrs:{id:"微服务项目简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微服务项目简介"}},[s._v("#")]),s._v(" 微服务项目简介")]),s._v(" "),n("h3",{attrs:{id:"选型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#选型"}},[s._v("#")]),s._v(" 选型")]),s._v(" "),n("ul",[n("li",[s._v("Nacos注册中心")]),s._v(" "),n("li",[s._v("Dubbo 微服务内部RPC")])]),s._v(" "),n("h3",{attrs:{id:"业务逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务逻辑"}},[s._v("#")]),s._v(" 业务逻辑")]),s._v(" "),n("p",[s._v("本次实验的目的是走通实验k8s环境部署微服务的流程，业务内容使用最简单的订单新增")]),s._v(" "),n("p",[s._v("创建3个maven项目")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("sparrow-controller：控制层提供http服务")]),s._v(" "),n("ul",[n("li",[s._v("sparrow-controller-order")])])]),s._v(" "),n("li",[n("p",[s._v("sparrow-business：业务层 提供dubbo服务供控制层调用")]),s._v(" "),n("ul",[n("li",[s._v("sparrow-business-order")])])]),s._v(" "),n("li",[n("p",[s._v("sparrow-repository：数据访问层 实现数据访问")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("sparrow-repository-order")]),s._v(" "),n("p",[s._v("连接k8s集群外部另一台虚拟机上的mysql")])])])])]),s._v(" "),n("p",[s._v("依赖关系")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("sparrow-business依赖sparrow-repository")]),s._v(" "),n("p",[s._v("sparrow-repository中通过Mybatis实现对数据库的操作，打包到sparrow-business项目中")]),s._v(" "),n("blockquote",[n("p",[s._v("sparrow是一个SpringBoot项目，也可以单独模块部署，对业务层提供dubbo服务")]),s._v(" "),n("p",[s._v("单独部署需要修改业务层项目的pom依赖，剔除jdbc的相关依赖，并且业务层也要作为dubbo客户端调用数据访问层的服务")])])]),s._v(" "),n("li",[n("p",[s._v("sparrow-controller依赖sparrow-business和sparrow-repository")]),s._v(" "),n("p",[s._v("本例中，控制层依赖sparrow-business的dubbo服务接口"),n("code",[s._v("IOrderService")]),s._v("；sparrow-business传导依赖了sparrow-repository中的领域模型"),n("code",[s._v("Order")]),s._v("作为DTO")]),s._v(" "),n("p",[s._v("pom中需要注意，剔除sparrow-business-order中数据访问的相关依赖，spring的依赖注入机制会自动不加载相关的组件")]),s._v(" "),n("blockquote",[n("p",[s._v("MybatisPlusAutoConfiguration中的"),n("code",[s._v("@ConditionalOnClass({SqlSessionFactory.class, SqlSessionFactoryBean.class})")])])]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.ly817"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sparrow-business-order"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${project.version}"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclusions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--排除来自sparrow-business-order中的jdbc设置 这里不需要加载数据库--\x3e")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclusion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.zaxxer"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("HikariCP"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclusion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--阻止依赖的repository中加载mapper--\x3e")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclusion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.mybatis"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("mybatis-spring"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclusion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclusions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])])])]),s._v(" "),n("blockquote",[n("p",[s._v("sparrow寓意这个项目麻雀虽小五脏俱全的意思")])]),s._v(" "),n("h2",{attrs:{id:"整体部署概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#整体部署概述"}},[s._v("#")]),s._v(" 整体部署概述")]),s._v(" "),n("p",[n("img",{attrs:{src:t(528),alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("三节点peer-to-peer模式的Nacos集群\n"),n("ul",[n("li",[s._v("Headless Service 不使用k8s自带的负载均衡")]),s._v(" "),n("li",[s._v("固定的域名 给其他微服务作为服务注册中心地址")])])]),s._v(" "),n("li",[s._v("2实例 业务层订单服务\n"),n("ul",[n("li",[s._v("Headless Service")]),s._v(" "),n("li",[s._v("微服务之间使用PodIp "),n("code",[s._v("10.244.x.x")]),s._v("进行通信")])])]),s._v(" "),n("li",[s._v("2实例 控制层订单服务\n"),n("ul",[n("li",[s._v("创建NodePort类型的Service 供外部访问测试")])])])]),s._v(" "),n("h1",{attrs:{id:"部署nacos注册中心"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署nacos注册中心"}},[s._v("#")]),s._v(" 部署Nacos注册中心")]),s._v(" "),n("h2",{attrs:{id:"部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),n("p",[s._v("官方提供的脚本"),n("code",[s._v("https://github.com/nacos-group/nacos-k8s.git")])]),s._v(" "),n("p",[s._v("使用quick-start.sh")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("kubectl create -f ./deploy/mysql/mysql-local.yaml")]),s._v(" 创建数据持久化使用的mysql")]),s._v(" "),n("li",[n("code",[s._v("kubectl create -f ./deploy/nacos/nacos-quick-start.yaml")]),s._v(" 创建nacos server StatefulSet")])]),s._v(" "),n("h3",{attrs:{id:"mysql-local"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-local"}},[s._v("#")]),s._v(" mysql-local")]),s._v(" "),n("p",[s._v("创建一个mysql实例作为nacos的持久化存储")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ReplicationController\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos/nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/lib/mysql\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_ROOT_PASSWORD\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_DATABASE\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos_devtest"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_USER\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_PASSWORD\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/lib/mysql\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br")])]),n("h3",{attrs:{id:"nacos-quick-start"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos-quick-start"}},[s._v("#")]),s._v(" nacos-quick-start")]),s._v(" "),n("h4",{attrs:{id:"service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[s._v("#")]),s._v(" Service")]),s._v(" "),n("p",[s._v("创建service指向名称为nacos-headless的资源，定义网络路由规则")]),s._v(" "),n("h5",{attrs:{id:"headless-service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#headless-service"}},[s._v("#")]),s._v(" Headless Service")]),s._v(" "),n("p",[s._v("创建ClusterIP类型、clusterIP为None的service")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" server\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h5",{attrs:{id:"nodeport-service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodeport-service"}},[s._v("#")]),s._v(" NodePort Service")]),s._v(" "),n("p",[s._v("便于通过访问所有宿主机（Node）的指定端口来访问")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("open\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("31111")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" server\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h4",{attrs:{id:"configmap"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#configmap"}},[s._v("#")]),s._v(" ConfigMap")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cm\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql.db.name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos_devtest"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql.port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3306"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql.user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql.password")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"statefulset"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#statefulset"}},[s._v("#")]),s._v(" StatefulSet")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StatefulSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pod.alpha.kubernetes.io/initialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("affinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podAntiAffinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requiredDuringSchedulingIgnoredDuringExecution")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labelSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchExpressions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app"')]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" In\n                    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("values")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("topologyKey")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.io/hostname"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" k8snacos\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos/nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2Gi"')]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"500m"')]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" client\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NACOS_REPLICAS\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_SERVICE_DB_NAME\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMapKeyRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cm\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql.db.name\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_SERVICE_PORT\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMapKeyRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cm\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql.port\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_SERVICE_USER\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMapKeyRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cm\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql.user\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_SERVICE_PASSWORD\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMapKeyRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cm\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql.password\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NACOS_SERVER_PORT\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8848"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PREFER_HOST_MODE\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hostname"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NACOS_SERVERS\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos-0.nacos-headless.default.svc.cluster.local:8848 nacos-1.nacos-headless.default.svc.cluster.local:8848 nacos-2.nacos-headless.default.svc.cluster.local:8848"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br")])]),n("h2",{attrs:{id:"测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),n("p",[s._v("访问访问绑定的NodePort端口31111查看是否可以正常登陆")]),s._v(" "),n("h1",{attrs:{id:"部署微服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署微服务"}},[s._v("#")]),s._v(" 部署微服务")]),s._v(" "),n("h2",{attrs:{id:"程序相关配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#程序相关配置"}},[s._v("#")]),s._v(" 程序相关配置")]),s._v(" "),n("h3",{attrs:{id:"springboot多环境配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#springboot多环境配置"}},[s._v("#")]),s._v(" SpringBoot多环境配置")]),s._v(" "),n("p",[s._v("创建k8s环境专用的SpringBoot配置文件"),n("code",[s._v("application-k8s.yaml")]),s._v("来接受环境变量，容器的启动脚本中通过"),n("code",[s._v("--spring.profiles.active=k8s")]),s._v("来指定生效的配置文件")]),s._v(" "),n("h3",{attrs:{id:"外部化配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#外部化配置"}},[s._v("#")]),s._v(" 外部化配置")]),s._v(" "),n("blockquote",[n("p",[s._v("配置传递的层次")]),s._v(" "),n("p",[s._v("k8s资源描述文件中的环境变量设置 => docker容器 => shell获取环境变量 => 启动脚本 => SpringBoot应用")])]),s._v(" "),n("p",[s._v("在配置文件"),n("code",[s._v("application-k8s.yaml")]),s._v("中使用"),n("code",[s._v("${k8s.nacos-server}")]),s._v("占位符来获取外部传入的参数。然后通过shell启动脚本获取容器提供的环境变量，作为启动参数传给SpringBoot应用（可以通过${}直接获取环境变量）")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      config:")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        server-addr: 127.0.0.1:8848")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        file-extension: yaml")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register-enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("k8s.nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("       \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("blockquote",[n("p",[s._v("nacos服务地址作为环境变量传入固定的域名")]),s._v(" "),n("p",[s._v("nacos-0.nacos-headless.default.svc.cluster.local:8848,nacos-1.nacos-headless.default.svc.cluster.local:8848,nacos-2.nacos-headless.default.svc.cluster.local:8848")])]),s._v(" "),n("h2",{attrs:{id:"构建docker镜像并推送到harbor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建docker镜像并推送到harbor"}},[s._v("#")]),s._v(" 构建docker镜像并推送到harbor")]),s._v(" "),n("p",[s._v("在maven项目的根目录创建构建脚本 build.sh")]),s._v(" "),n("h3",{attrs:{id:"构建可执行jar"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建可执行jar"}},[s._v("#")]),s._v(" 构建可执行jar")]),s._v(" "),n("p",[s._v("使用maven打包，在pom的配置中指定生成jar包的名称与微服务名同名")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("finalName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sparrow-business-order"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("finalName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  ...\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"build-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build-sh"}},[s._v("#")]),s._v(" build.sh")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地生成jar包 ")]),s._v("\nmvn clean "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -DskipTests\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"构建docker镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建docker镜像"}},[s._v("#")]),s._v(" 构建docker镜像")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jre\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" author="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"luoyu817"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" email="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"luoyu817@126.com"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将生成的可执行jar包添加到镜像中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" ./target/sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order.jar /usr/local/app.jar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将启动脚本添加到镜像中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" ./entrypoint.sh /usr/local/entrypoint.sh\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用ENTRYPOINT执行启动脚本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/entrypoint.sh"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露dubbo端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 20880\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"build-sh-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build-sh-2"}},[s._v("#")]),s._v(" build.sh")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建docker镜像")]),s._v("\ndocker build -t sparrow-business-order:latest "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地测试容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#docker run -e NACOS_SERVERS="192.168.3.24:8848" sparrow-business-order:latest')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"推送到harbor私有镜像仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#推送到harbor私有镜像仓库"}},[s._v("#")]),s._v(" 推送到harbor私有镜像仓库")]),s._v(" "),n("h4",{attrs:{id:"harbor仓库搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#harbor仓库搭建"}},[s._v("#")]),s._v(" harbor仓库搭建")]),s._v(" "),n("p",[s._v("harbor镜像仓库使用虚拟机拉取镜像搭建")]),s._v(" "),n("p",[n("code",[s._v("https://github.com/goharbor/harbor/releases/download/v2.0.0/harbor-offline-installer-v2.0.0.tgz")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("解压 进入harbor目录")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("cp harbor.yml.tmpl harbor.yml")])]),s._v(" "),n("p",[s._v("修改hostname属性为自定义域名，这里我用的"),n("code",[s._v("harbor.local.com")])]),s._v(" "),n("p",[s._v("这个hostname作为镜像标签的域名"),n("code",[s._v("hostname/repository/appName:version")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("./install.sh")]),s._v("安装")])])]),s._v(" "),n("h4",{attrs:{id:"相关配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关配置"}},[s._v("#")]),s._v(" 相关配置")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("配置"),n("code",[s._v("/etc/hosts")]),s._v(" 添加虚拟机ip与hostname域名的对应关系")])]),s._v(" "),n("li",[n("p",[s._v("客户端docker daemon.json文件中添加允许访问的仓库域名")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ...\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.local.com"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])]),s._v(" "),n("h4",{attrs:{id:"build-sh-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build-sh-3"}},[s._v("#")]),s._v(" build.sh")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据远程仓库的hostname以及repository 为进行打上tag")]),s._v("\ndocker tag sparrow-business-order:latest harbor.local.com/sparrow/sparrow-business-order:latest\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录并推送到harbor远程镜像仓库")]),s._v("\ndocker login harbor.local.com -u admin -p Harbor12345\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送对应tag的镜像")]),s._v("\ndocker push harbor.local.com/sparrow/sparrow-business-order:latest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"k8s创建工作负载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#k8s创建工作负载"}},[s._v("#")]),s._v(" k8s创建工作负载")]),s._v(" "),n("p",[s._v("使用kuboard可视化界面部署")]),s._v(" "),n("p",[n("img",{attrs:{src:t(529),alt:""}})]),s._v(" "),n("p",[s._v("提前配置镜像仓库的登录用户名和密码")]),s._v(" "),n("p",[n("img",{attrs:{src:t(530),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"sparrow-business-order"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sparrow-business-order"}},[s._v("#")]),s._v(" sparrow-business-order")]),s._v(" "),n("h4",{attrs:{id:"statefulset-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#statefulset-2"}},[s._v("#")]),s._v(" StatefulSet")]),s._v(" "),n("ul",[n("li",[s._v("设置副本数为2")]),s._v(" "),n("li",[s._v("绑定容器端口到Pod")]),s._v(" "),n("li",[s._v("添加环境变量NACOS_SERVERS 将服务注册到上一步部署的Nacos集群上")])]),s._v(" "),n("p",[s._v("kuboard生成的资源描述文件")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StatefulSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/displayName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/ingress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'false'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/workload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-05-26T23:27:53Z'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("generation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'483186'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selfLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /apis/apps/v1/namespaces/default/statefulsets/sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 355bdaef"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("75ca"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4894"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("96cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("33facf6ac404\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podManagementPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" OrderedReady\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("revisionHistoryLimit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NACOS_SERVERS\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n                nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("2.nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'harbor.local.com/sparrow/sparrow-business-order:latest'")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20880")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20880")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationMessagePath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /dev/termination"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationMessagePolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" File\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullSecrets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" harbor.local.com\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schedulerName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("scheduler\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationGracePeriodSeconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("updateStrategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rollingUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("partition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RollingUpdate\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("collisionCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("currentReplicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("currentRevision")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("9b677646c\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("observedGeneration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readyReplicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("updateRevision")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("9b677646c\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("updatedReplicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br")])]),n("h4",{attrs:{id:"headless-service-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#headless-service-2"}},[s._v("#")]),s._v(" Headless Service")]),s._v(" "),n("ul",[n("li",[s._v("clusterIP设置为None")])]),s._v(" "),n("p",[s._v("kuboard生成的资源描述文件")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/displayName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/workload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-05-26T23:27:53Z'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'348646'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selfLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /api/v1/namespaces/default/services/sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3b4ef544"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fcb4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("47bf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a877"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a98bfeca78a3\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sessionAffinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h3",{attrs:{id:"sparrow-controller-order"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sparrow-controller-order"}},[s._v("#")]),s._v(" sparrow-controller-order")]),s._v(" "),n("h4",{attrs:{id:"statefulset-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#statefulset-3"}},[s._v("#")]),s._v(" StatefulSet")]),s._v(" "),n("ul",[n("li",[s._v("设置副本数为2")]),s._v(" "),n("li",[s._v("绑定容器端口到Pod")]),s._v(" "),n("li",[s._v("添加环境变量NACOS_SERVERS")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StatefulSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/displayName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/ingress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'false'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/workload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-05-27T02:02:43Z'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("generation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'483184'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selfLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /apis/apps/v1/namespaces/default/statefulsets/sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3a2d3e19"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5694"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4d31"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aa01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("37f43f2ec0fc\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podManagementPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" OrderedReady\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("revisionHistoryLimit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NACOS_SERVERS\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n                nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("2.nacos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headless.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'harbor.local.com/sparrow/sparrow-controller-order:latest'")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationMessagePath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /dev/termination"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationMessagePolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" File\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullSecrets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" harbor.local.com\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schedulerName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("scheduler\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationGracePeriodSeconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("updateStrategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rollingUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("partition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RollingUpdate\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("collisionCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("currentReplicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("currentRevision")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("77f9b7999f\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("observedGeneration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readyReplicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("updateRevision")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("77f9b7999f\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("updatedReplicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br")])]),n("h4",{attrs:{id:"nodeport-service-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodeport-service-2"}},[s._v("#")]),s._v(" NodePort Service")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/displayName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/workload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-05-27T02:02:43Z'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'371035'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selfLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /api/v1/namespaces/default/services/sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 41659099"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3069"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4be2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("b78a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("b38c196425a1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.1.21.64\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("externalTrafficPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Cluster\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" r6jda2\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30003")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s.kuboard.cn/name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sparrow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sessionAffinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("h2",{attrs:{id:"测试-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),n("ul",[n("li",[s._v("访问Nacos暴露的NodePort看服务是否注册")]),s._v(" "),n("li",[s._v("访问暴露的NodePort控制层接口，验证调用链是否有问题")]),s._v(" "),n("li",[s._v("有问题可以通过kuboard检查\n"),n("ul",[n("li",[s._v("登录到对应pod的/bin/sh")]),s._v(" "),n("li",[s._v("下载对应pod的日志")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);