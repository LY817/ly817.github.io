(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{589:function(v,a,t){v.exports=t.p+"assets/img/774371-20190625095358537-234159337.7ce04b4d.png"},590:function(v,a){v.exports="data:image/png;base64,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"},591:function(v,a,t){v.exports=t.p+"assets/img/774371-20190625095446926-753231622.7a866cb3.png"},592:function(v,a,t){v.exports=t.p+"assets/img/70.9c9af0aa.png"},593:function(v,a,t){v.exports=t.p+"assets/img/image-20200515220025147.a38a8763.png"},594:function(v,a,t){v.exports=t.p+"assets/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjAxMjkxMQ==,size_16,color_FFFFFF,t_70.5ad3ea43.png"},595:function(v,a,t){v.exports=t.p+"assets/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjAxMjkxMQ==,size_16,color_FFFFFF,t_70-20200516102514987.943ab199.png"},596:function(v,a,t){v.exports=t.p+"assets/img/70-20200516131838582.941d21e9.png"},597:function(v,a,t){v.exports=t.p+"assets/img/image-20210722135214951.5ad9209e.png"},598:function(v,a,t){v.exports=t.p+"assets/img/image-20200207112222656.13ddca4f.png"},660:function(v,a,t){"use strict";t.r(a);var _=t(21),r=Object(_.a)({},(function(){var v=this,a=v.$createElement,_=v._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"常见存储引擎概述"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#常见存储引擎概述"}},[v._v("#")]),v._v(" 常见存储引擎概述")]),v._v(" "),_("h3",{attrs:{id:"innodb"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#innodb"}},[v._v("#")]),v._v(" InnoDB")]),v._v(" "),_("ul",[_("li",[v._v("适用场景\n"),_("ul",[_("li",[v._v("大多数OLTP场景")])])]),v._v(" "),_("li",[_("strong",[v._v("事务型")]),v._v(" 支持ACID\n"),_("ul",[_("li",[v._v("不能混合使用事务和非事务存储引擎")]),v._v(" "),_("li",[_("code",[v._v("begin transaction")]),v._v(" >> "),_("code",[v._v("commit")])])])]),v._v(" "),_("li",[v._v("存储实现：数据按"),_("strong",[v._v("主键")]),v._v("聚集存储（"),_("strong",[v._v("聚集索引")]),v._v("）\n"),_("ul",[_("li",[v._v("必须有主键")]),v._v(" "),_("li",[v._v("其他索引都指向主键，然后进行二次寻址\n"),_("ul",[_("li",[v._v("主键索引 >> 行数据")]),v._v(" "),_("li",[v._v("其他所有 >> 主键索引")])])])])]),v._v(" "),_("li",[v._v("存储文件：表和索引信息在一个文件中\n"),_("ul",[_("li",[v._v("IDB：存储表和索引")]),v._v(" "),_("li",[v._v("frm：8.0之后 移除")])])]),v._v(" "),_("li",[v._v("支持行级锁及MVCC\n"),_("ul",[_("li",[v._v("行级锁提高并发性能")]),v._v(" "),_("li",[v._v("MVCC：可以并发进行读操作和写操作")]),v._v(" "),_("li",[v._v("支持for udpate")])])]),v._v(" "),_("li",[v._v("支持Btree和自适应Hash索引，支持全文和空间索引\n"),_("ul",[_("li",[v._v("Hash索引只使用于等值查询")])])])]),v._v(" "),_("h3",{attrs:{id:"myisam"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#myisam"}},[v._v("#")]),v._v(" MyISAM")]),v._v(" "),_("p",[v._v("Indexed Sequential Access Method")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("适用场景")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("读操作远大于写操作")]),v._v("的场景")]),v._v(" "),_("li",[v._v("不需要事务")])])]),v._v(" "),_("li",[_("p",[_("strong",[v._v("非事务型")])])]),v._v(" "),_("li",[_("p",[v._v("存储实现：以堆表进行存储 "),_("strong",[v._v("查询性能好")]),v._v("于innodb")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("快速读取")]),v._v("：索引的叶子节点"),_("strong",[v._v("直接指向")]),v._v("的是数据存储的实际位置\n"),_("ul",[_("li",[v._v("MYI 中存放的是 索引-数据行物理存储地址的键值对")])])]),v._v(" "),_("li",[v._v("修改性能差：每次写操作都要维护数据和索引信息\n"),_("ul",[_("li",[v._v("数据越多，写操作效率越低")]),v._v(" "),_("li",[v._v("索引越多，效率越低")])])])])]),v._v(" "),_("li",[_("p",[v._v("存储文件：由两个文件组成，分布存储数据和索引")]),v._v(" "),_("ul",[_("li",[v._v("MYD 数据")]),v._v(" "),_("li",[v._v("MYI 索引")]),v._v(" "),_("li",[v._v("frm：表结构信息 8.0之后被删除")])])]),v._v(" "),_("li",[_("p",[v._v("缺点")]),v._v(" "),_("ul",[_("li",[v._v("不支持事务和"),_("strong",[v._v("外键")])]),v._v(" "),_("li",[v._v("不能容错 需要经常备份\n"),_("ul",[_("li",[v._v("不能在表损坏（表信息）后恢复数据")]),v._v(" "),_("li",[v._v("磁盘崩溃可以使用工具（MyISAMCHK）来修复数据")])])]),v._v(" "),_("li",[v._v("占用空间（表格锁定机制优化并发的读写操作）\n"),_("ul",[_("li",[v._v("需要定时使用MyISAMPACK来清理空间")])])])])]),v._v(" "),_("li",[_("p",[v._v("使用"),_("strong",[v._v("表级锁")]),v._v(" 读写操作相互阻塞")])]),v._v(" "),_("li",[_("p",[v._v("索引")]),v._v(" "),_("ul",[_("li",[v._v("Btree")]),v._v(" "),_("li",[v._v("空间索引")]),v._v(" "),_("li",[v._v("全文索引")])])])]),v._v(" "),_("h3",{attrs:{id:"csv"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#csv"}},[v._v("#")]),v._v(" CSV")]),v._v(" "),_("ul",[_("li",[v._v("适用场景\n"),_("ul",[_("li",[v._v("作为数据交换的中间表使用\n"),_("ul",[_("li",[v._v("csv格式文件的通用性")])])])])]),v._v(" "),_("li",[v._v("非事务型存储引擎")]),v._v(" "),_("li",[v._v("所有列必须为"),_("strong",[v._v("非空")])]),v._v(" "),_("li",[v._v("不支持索引")]),v._v(" "),_("li",[v._v("文件存储：以CSV文件存储")])]),v._v(" "),_("h3",{attrs:{id:"archive"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#archive"}},[v._v("#")]),v._v(" Archive")]),v._v(" "),_("ul",[_("li",[v._v("适用场景\n"),_("ul",[_("li",[v._v("日志类或数据采集类")]),v._v(" "),_("li",[v._v("数据归档")])])]),v._v(" "),_("li",[v._v("非事务型存储引擎")]),v._v(" "),_("li",[v._v("表数据使用zlib进行压缩 "),_("strong",[v._v("节约空间")])]),v._v(" "),_("li",[v._v("只支持insert和select")]),v._v(" "),_("li",[v._v("只运行在自增ID上建索引")])]),v._v(" "),_("h3",{attrs:{id:"memory"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#memory"}},[v._v("#")]),v._v(" Memory")]),v._v(" "),_("ul",[_("li",[v._v("适用场景\n"),_("ul",[_("li",[v._v("缓存字典映射表")]),v._v(" "),_("li",[v._v("缓存周期性分析数据")])])]),v._v(" "),_("li",[v._v("非事务型存储引擎")]),v._v(" "),_("li",[v._v("数据保存在"),_("strong",[v._v("内存")]),v._v("中\n"),_("ul",[_("li",[v._v("重启会丢失")]),v._v(" "),_("li",[v._v("没有磁盘io，读取性能好")])])]),v._v(" "),_("li",[v._v("所有字段长度固定")]),v._v(" "),_("li",[v._v("支持Btree和Hash索引")])]),v._v(" "),_("h1",{attrs:{id:"innodb-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#innodb-2"}},[v._v("#")]),v._v(" InnoDB")]),v._v(" "),_("h2",{attrs:{id:"存储数据结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#存储数据结构"}},[v._v("#")]),v._v(" 存储数据结构")]),v._v(" "),_("h3",{attrs:{id:"数据页"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据页"}},[v._v("#")]),v._v(" 数据页")]),v._v(" "),_("p",[v._v("数据页是InnoDB存储的最基本构件，也是InnoDB磁盘管理的最小单位")]),v._v(" "),_("blockquote",[_("p",[_("code",[v._v("Innodb_page_size")]),v._v(" 分页大小 一次从文件系统读取的大小 默认为"),_("strong",[v._v("16kb")])]),v._v(" "),_("p",[v._v("局部性原理：当访问某一条数据时，之后有很大概率访问该条数据附近数据。每次进行磁盘IO，会读取整个数据页到内存")])]),v._v(" "),_("h4",{attrs:{id:"数据页分类"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据页分类"}},[v._v("#")]),v._v(" 数据页分类")]),v._v(" "),_("h5",{attrs:{id:"数据页-b-tree-node"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据页-b-tree-node"}},[v._v("#")]),v._v(" 数据页（B-tree Node）")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("目录页：directory page")]),v._v(" "),_("p",[v._v("数据页上实现B+树索引的数据结构")]),v._v(" "),_("p",[v._v("只存储索引信息，不存储具体的数据行")]),v._v(" "),_("p",[v._v("顺序存储一张表的多个数据页的地址指针\n聚合主键+指针")])]),v._v(" "),_("li",[_("p",[v._v("数据页：data page")])])]),v._v(" "),_("h5",{attrs:{id:"undo页-undo-log-page"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#undo页-undo-log-page"}},[v._v("#")]),v._v(" Undo页（Undo Log Page）")]),v._v(" "),_("p",[v._v("Undo log是InnoDB MVCC事务特性的重要组成部分。当我们对记录做了变更操作时就会产生undo记录，Undo记录默认被记录到系统表空间(ibdata)中，但从5.6开始，也可以使用独立的Undo 表空间")]),v._v(" "),_("p",[_("a",{attrs:{href:"https://blog.csdn.net/qq_39459385/article/details/84644005",target:"_blank",rel:"noopener noreferrer"}},[v._v("详见"),_("OutboundLink")],1)]),v._v(" "),_("h5",{attrs:{id:"系统页-system-page"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#系统页-system-page"}},[v._v("#")]),v._v(" 系统页（System Page）")]),v._v(" "),_("p",[v._v("用于保存mysql系统数据")]),v._v(" "),_("h5",{attrs:{id:"事务数据页-transaction-system-page"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#事务数据页-transaction-system-page"}},[v._v("#")]),v._v(" 事务数据页（Transaction System Page）")]),v._v(" "),_("p",[v._v("用于保存事务相关数据")]),v._v(" "),_("h4",{attrs:{id:"数据页数据结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据页数据结构"}},[v._v("#")]),v._v(" 数据页数据结构")]),v._v(" "),_("p",[_("img",{attrs:{src:t(589),alt:""}})]),v._v(" "),_("h5",{attrs:{id:"page-header"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#page-header"}},[v._v("#")]),v._v(" Page Header")]),v._v(" "),_("p",[v._v("包含数据页的相关元信息")]),v._v(" "),_("h6",{attrs:{id:"page-number"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#page-number"}},[v._v("#")]),v._v(" Page Number")]),v._v(" "),_("p",[v._v("数据页序号")]),v._v(" "),_("h6",{attrs:{id:"上下页指针"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#上下页指针"}},[v._v("#")]),v._v(" 上下页指针")]),v._v(" "),_("p",[v._v("Page的头部保存了两个指针（Previous Page和Next Page），分别指向前一个Page和后一个Page。链接起来就是一个双向链表的结构")]),v._v(" "),_("p",[_("img",{attrs:{src:t(590),alt:""}})]),v._v(" "),_("h6",{attrs:{id:"page-type"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#page-type"}},[v._v("#")]),v._v(" Page Type")]),v._v(" "),_("p",[v._v("区分数据页类型")]),v._v(" "),_("h5",{attrs:{id:"user-record"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#user-record"}},[v._v("#")]),v._v(" User Record")]),v._v(" "),_("p",[_("code",[v._v("free space")]),v._v("  用于存放一行行record，根据数据页的类型而变")]),v._v(" "),_("p",[v._v('record以链表的形式组织，链表头尾由固定内容的两条字符串形式的记录来表示："Infimum"代表开头，"Supremum"代表结尾')]),v._v(" "),_("p",[_("img",{attrs:{src:t(591),alt:""}})]),v._v(" "),_("p",[v._v("InnoDB存在4种不同的Record，它们分别是")]),v._v(" "),_("ul",[_("li",[v._v("主键索引树非叶节点 - "),_("code",[v._v("page directory")])]),v._v(" "),_("li",[v._v("主键索引树叶子节点 - 存储数据行")]),v._v(" "),_("li",[v._v("辅助键索引树非叶节点 - 非主键索引的 "),_("code",[v._v("page directory")])]),v._v(" "),_("li",[v._v("辅助键索引树叶子节点 - 非主键索引与主键的对应关系")])]),v._v(" "),_("h6",{attrs:{id:"page-directory"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#page-directory"}},[v._v("#")]),v._v(" page directory")]),v._v(" "),_("p",[v._v("保存这个数据页中索引列的 ”分段“数据指针")]),v._v(" "),_("h6",{attrs:{id:"row"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#row"}},[v._v("#")]),v._v(" row")]),v._v(" "),_("p",[v._v("存储数据行")]),v._v(" "),_("h5",{attrs:{id:"file-trailer"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#file-trailer"}},[v._v("#")]),v._v(" file trailer")]),v._v(" "),_("p",[v._v("文件尾部")]),v._v(" "),_("h3",{attrs:{id:"b-树结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#b-树结构"}},[v._v("#")]),v._v(" B+树结构")]),v._v(" "),_("p",[v._v("InnoDB中的数据根据主键的顺序，以B+树的结构组织存储")]),v._v(" "),_("h4",{attrs:{id:"特点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[v._v("#")]),v._v(" 特点")]),v._v(" "),_("ul",[_("li",[v._v("非叶子节点只存放索引key")]),v._v(" "),_("li",[v._v("一个节点存多个元素（行），降低树的高度（3层），减少查询次数\n"),_("ul",[_("li",[v._v("数据都保存在叶子节点 所有数据都需要经过相同的io次数查询到")])])]),v._v(" "),_("li",[v._v("叶子节点之间添加"),_("strong",[v._v("链表结构")]),v._v(" 便于范围查找")])]),v._v(" "),_("blockquote",[_("p",[v._v("树型数据结构对比")]),v._v(" "),_("ul",[_("li",[v._v("传统二叉树\n极端情况二叉树会变成链表")]),v._v(" "),_("li",[v._v("红黑树 平衡二叉树\n二叉树的层数随数据量的增加而增加，提高查询的io次数")]),v._v(" "),_("li",[v._v("B-树：多路搜索树\n一个节点有多个元素 但元素分散，不便于遍历")]),v._v(" "),_("li",[v._v("B+树\n控制（树的层数）查询的io次数\n每个元素的查找的io次数都是树的高度\n元素集中在叶子节点，方便遍历")])]),v._v(" "),_("p",[_("a",{attrs:{href:"https://www.cs.usfca.edu/~galles/visualization/Algorithms.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("图形化数据结构"),_("OutboundLink")],1)])]),v._v(" "),_("h4",{attrs:{id:"基本数据行存储结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#基本数据行存储结构"}},[v._v("#")]),v._v(" 基本数据行存储结构")]),v._v(" "),_("p",[v._v("数据行索引通过主键组织存储")]),v._v(" "),_("p",[v._v("B+树的非叶子节点的数据页不保存具体表记录，被缓存在内存中提高查询效率")]),v._v(" "),_("h6",{attrs:{id:"示意图"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#示意图"}},[v._v("#")]),v._v(" 示意图")]),v._v(" "),_("p",[_("img",{attrs:{src:t(592),alt:""}})]),v._v(" "),_("h5",{attrs:{id:"非主键索引"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#非主键索引"}},[v._v("#")]),v._v(" 非主键索引")]),v._v(" "),_("p",[v._v("InnoDB中的非主键索引，是根据主键创建另一个B+树。")]),v._v(" "),_("p",[v._v("通过索引值找到对应的主键，然后在通过主键找到对应的数据行，这就是所谓的回表")]),v._v(" "),_("h6",{attrs:{id:"示意图-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#示意图-2"}},[v._v("#")]),v._v(" 示意图")]),v._v(" "),_("p",[_("img",{attrs:{src:t(593),alt:""}})]),v._v(" "),_("p",[_("a",{attrs:{href:"https://www.cnblogs.com/williamjie/p/11081081.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("参考"),_("OutboundLink")],1)]),v._v(" "),_("h3",{attrs:{id:"引申-随机读写和顺序读写"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#引申-随机读写和顺序读写"}},[v._v("#")]),v._v(" 引申：随机读写和顺序读写")]),v._v(" "),_("h4",{attrs:{id:"随机读写"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#随机读写"}},[v._v("#")]),v._v(" 随机读写")]),v._v(" "),_("p",[v._v("上述的MySQL InnoDB中数据页的存储结构使用到大量存储地址指针，说明表记录文件存储使用的是随机IO")]),v._v(" "),_("p",[_("img",{attrs:{src:t(594),alt:""}})]),v._v(" "),_("h5",{attrs:{id:"优点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[v._v("#")]),v._v(" 优点")]),v._v(" "),_("p",[v._v("适用于增删改查（随机读）频繁的场景")]),v._v(" "),_("h5",{attrs:{id:"缺点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[v._v("#")]),v._v(" 缺点")]),v._v(" "),_("p",[v._v("读写性能低")]),v._v(" "),_("h4",{attrs:{id:"顺序读写"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#顺序读写"}},[v._v("#")]),v._v(" 顺序读写")]),v._v(" "),_("p",[v._v("而MySQL中日志类的文件使用的是redo log,binlog这种日志进行的磁盘顺序读写")]),v._v(" "),_("p",[_("img",{attrs:{src:t(595),alt:""}})]),v._v(" "),_("p",[v._v("除此之外，RocketMQ、Kafka、ElasticSearch的文件系统也是使用了顺序读写来实现，来提高性能")]),v._v(" "),_("h5",{attrs:{id:"优点-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#优点-2"}},[v._v("#")]),v._v(" 优点")]),v._v(" "),_("p",[v._v("读写性能高")]),v._v(" "),_("p",[v._v("顺序读写=读取一个大文件\n随机读写=读取多个小文件")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("顺序读写，主要时间花费在了传输时间，而这个时间两种读写可以认为是一样的。\n随机读写，需要多次寻道和旋转延迟。而这个时间可能是传输时间的许多倍。")])]),v._v(" "),_("li",[_("p",[v._v("顺序读写，磁盘会预读，预读即在读取的起始地址连续读取多个页面\n（现在不需要的页面也读取了，这样以后用时就不用再读取，当一个页面用到时，大多数情况下，它周围的页面也会被用到）")]),v._v(" "),_("p",[v._v("而随机读写，因为数据没有在一起，将预读浪费掉了。")])]),v._v(" "),_("li",[_("p",[v._v("文件系统的overhead\n读写一个文件之前，得一层层目录找到这个文件，以及做一堆属性、权限之类的检查。\n写新文件时还要加上寻找磁盘可用空间的耗时。")])])]),v._v(" "),_("h5",{attrs:{id:"缺点-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缺点-2"}},[v._v("#")]),v._v(" 缺点")]),v._v(" "),_("p",[v._v("不适用于修改/删除较频繁的场景。因为文件顺序读写实现只能追加写，其它的删、改都只能建立在append only的基础上，如删一条数据只能append一个记录，把要删的数据标记为删除，而不能从磁盘中删除原数据")]),v._v(" "),_("h2",{attrs:{id:"事务特性实现"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#事务特性实现"}},[v._v("#")]),v._v(" 事务特性实现")]),v._v(" "),_("p",[v._v("mysql自带的binlog没有crash-safe能力，是跨存储引擎的通用日志，用于数据归档备份（与全量备份组合，运维手动重放达到灾备的效果）和同步；InnoDB使用另外一套日志系统来实现事务的ACID特性，保证服务崩溃后能恢复数据的一致性")]),v._v(" "),_("blockquote",[_("p",[_("strong",[v._v("MyISAM没有crash-safe能力")]),v._v("，事务执行中服务崩溃对导致数据不一致")])]),v._v(" "),_("h3",{attrs:{id:"回滚日志-undo-log-【实现原子性-隔离性】"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#回滚日志-undo-log-【实现原子性-隔离性】"}},[v._v("#")]),v._v(" 回滚日志 Undo log 【实现原子性/隔离性】")]),v._v(" "),_("p",[v._v("InnoDB中，在任何数据操作之前，将数据备份到undoLog中。")]),v._v(" "),_("p",[v._v("如果执行出错或者客户端执行了rollback，可以利用undo log中的备份将数据恢复到事务开始之前的状态")]),v._v(" "),_("h4",{attrs:{id:"原子性-【回滚】"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#原子性-【回滚】"}},[v._v("#")]),v._v(" 原子性 【回滚】")]),v._v(" "),_("p",[v._v("事务的所有操作在数据库中要么全部反映，要么全部不反映")]),v._v(" "),_("p",[v._v("当事务执行失败回滚，根据undo log恢复到记录数据修改前的状态")]),v._v(" "),_("h4",{attrs:{id:"隔离性-【实现mvcc-其他事务查看事务操作前的版本】"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#隔离性-【实现mvcc-其他事务查看事务操作前的版本】"}},[v._v("#")]),v._v(" 隔离性  【实现MVCC 其他事务查看事务操作前的版本】")]),v._v(" "),_("p",[v._v("用来做资源隔离，让对数据的读写有顺序")]),v._v(" "),_("p",[v._v("分为共享锁和排他锁")]),v._v(" "),_("p",[v._v("数据"),_("strong",[v._v("查询")]),v._v("需要对资源加"),_("strong",[v._v("共享锁")]),v._v("（S）")]),v._v(" "),_("blockquote",[_("p",[v._v("保证"),_("strong",[v._v("读取过程")]),v._v("中不会被其他事务修改")])]),v._v(" "),_("p",[v._v("数据"),_("strong",[v._v("修改")]),v._v("需要对资源加"),_("strong",[v._v("排他锁")]),v._v("（x）")]),v._v(" "),_("blockquote",[_("p",[v._v("保证事务在修改数据过程中，不会被其他事务读到或者修改")])]),v._v(" "),_("h5",{attrs:{id:"mvcc-多版本并发控制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mvcc-多版本并发控制"}},[v._v("#")]),v._v(" MVCC 多版本并发控制")]),v._v(" "),_("p",[v._v("multipart version concurrency control")]),v._v(" "),_("p",[v._v("在innodb中，当一个事务（A）对数据进行修改时，另一个事务（B）还是可以读到被A上了"),_("strong",[v._v("排他锁")]),v._v("的值（但是看不到A未提交的修改）")]),v._v(" "),_("p",[v._v("利用到undo log，实际上是读取事务A的undo log中，数据修改前的值")]),v._v(" "),_("h3",{attrs:{id:"重做日志-redo-log-顺序写-【持久性-crash-safe】"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#重做日志-redo-log-顺序写-【持久性-crash-safe】"}},[v._v("#")]),v._v(" 重做日志 Redo log 顺序写 【持久性 "),_("strong",[v._v("crash-safe")]),v._v("】")]),v._v(" "),_("p",[v._v("当MySQL的实例和介质执行失败的时候，Innodb存储引擎就会使用重做日志文件进行恢复，保证事务的持久性。")]),v._v(" "),_("p",[v._v("redo log 由两部分组成：")]),v._v(" "),_("ul",[_("li",[v._v("内存中的重做日志缓冲（redo log buffer） 易丢失")]),v._v(" "),_("li",[v._v("重做日志文件（redo log file） 持久化")])]),v._v(" "),_("p",[_("img",{attrs:{src:t(596),alt:""}})]),v._v(" "),_("p",[v._v("首先将操作的redo_log放入重做日志缓冲区中，然后按一定的频率将其刷新到重做日志文件。该缓冲区不会设置得很大，因为默认"),_("strong",[v._v("每一秒刷新一次")]),v._v("到日志文件中")]),v._v(" "),_("p",[v._v("redo_log写入磁盘日志文件是"),_("strong",[v._v("顺序循环写入")]),v._v("（默认在mysql/data目录下面有两个文件ib_logfile0和ib_logfile1），ib_logfile写满之后，写另外一个，"),_("strong",[v._v("覆盖")]),v._v("之前的redo_log数据。")]),v._v(" "),_("h4",{attrs:{id:"checkpoint机制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#checkpoint机制"}},[v._v("#")]),v._v(" CheckPoint机制")]),v._v(" "),_("p",[v._v("下图所示的是四个文件的redo log，write pos为当前写日志的index，随着日志的写入不断后移。checkpoint表示检查redo_log的数据已经被持久化到数据页中，此时redo log处于prepare状态。")]),v._v(" "),_("p",[v._v("write pos到checkpoint之间的绿色区域为可以被覆盖的区域。当有高频的更新操作时，write pos会”追上“checkout，此时就不能再执行新的更新。")]),v._v(" "),_("p",[_("img",{attrs:{src:t(597),alt:"image-20210722135214951"}})]),v._v(" "),_("h4",{attrs:{id:"如何保证crash-save"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#如何保证crash-save"}},[v._v("#")]),v._v(" 如何保证crash-save")]),v._v(" "),_("p",[v._v("写入redolog是顺序写入，写入数据页是随机写入。对于机械硬盘而言，两者的理论写入效率相差几百倍。再加上数据页的数据结构操作的操作，写入redolog和写入数据页的效率相处3个数量级。")]),v._v(" "),_("p",[v._v("Write-Ahead Logging ：redolog是在数据库操作写入数据页之前就完成写入，"),_("strong",[v._v("redolog完成写入就表示该事务已经持久化成功")]),v._v("，crash之后的可以从redolog中恢复到数据页中，"),_("strong",[v._v("减小了宕机导致数据丢失的”窗口期“")]),v._v("。")]),v._v(" "),_("p",[v._v("通过配置"),_("code",[v._v("innodb_flush_log_at_trx_commit")]),v._v(" 来调整InnoDB redolog的刷盘策略（类似RocketMQ的同步刷盘和异步刷盘）")]),v._v(" "),_("p",[_("code",[v._v("0")]),v._v("：log buffer将每秒一次地写入log file中，并且log file的flush(刷到磁盘)操作同时进行。该模式下在事务提交的时候，不会主动触发写入磁盘的操作。")]),v._v(" "),_("p",[_("code",[v._v("1")]),v._v("："),_("strong",[v._v("每次事务提交")]),v._v("时MySQL都会把log buffer的数据写入log file，并且flush(刷到磁盘)中去，该模式为系统默认。")]),v._v(" "),_("p",[_("code",[v._v("2")]),v._v("：每次事务提交时MySQL都会把log buffer的数据写入log file，但是flush(刷到磁盘)操作并不会同时进行。该模式下，MySQL会每秒执行一次 flush(刷到磁盘)操作。")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("1不会丢失数据 但是性能最差")])]),v._v(" "),_("li",[_("p",[v._v("0、2先写入到系统缓存中，每隔一秒批量写入磁盘，提高io效率")])])]),v._v(" "),_("p",[v._v("如果断电或者宕机会丢失这一秒内的数据")]),v._v(" "),_("p",[_("img",{attrs:{src:t(598),alt:""}})])])}),[],!1,null,null,null);a.default=r.exports}}]);