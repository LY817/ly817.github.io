# InnoDB

## InnoDB事务特性实现

> 原来的MyISAM没有crash-safe能力，事务执行中服务崩溃对导致数据不一致
>
> mysql自带的binlog只用用于归档，没有crash-safe能力；InnoDB使用另外一套日志系统来保证服务崩溃后能恢复数据的一致性

#### 回滚日志 Undo log 【原子性】

记录数据修改前的状态

> 用于事务出现异常回滚到原来状态

#### 重做日志 Redo log 【一致性】

用于记录修改后的状态（sql执行结果，存在于缓存中，还未写入到磁盘）

> 当事务的所有操作都成功，**一起写入磁盘**

#### 锁 【隔离性】

用来做资源隔离，让对数据的读写有顺序

分为共享锁和排他锁

数据**查询**需要对资源加**共享锁**（S）

> 保证**读取过程**中不会被其他事务修改

数据**修改**需要对资源加**排他锁**（x）

> 保证事务在修改数据过程中，不会被其他事务读到或者修改

#### MVCC 多版本并发控制

在innodb中，当一个事务（A）对数据进行修改时，另一个事务（B）还是可以读到被A上了**排他锁**的值（但是看不到A未提交的修改）

利用到undo log，实际上是读取事务Aundo log中，数据修改的值

#### Undo + Redo 【持久性】